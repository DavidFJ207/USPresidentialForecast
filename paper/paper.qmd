---
title: "Forecasting the 2024 US Presidential Election"
subtitle: "Analyzing Demographic Patterns and Predicting Swing States"
author: 
  - Tina Kim
  - David Flores
  - Kevin Shao
thanks: "Code and data are available at: https://github.com/DavidFJ207/USPresidentialForecast"
date: today
date-format: long
abstract: This paper analyzes recent swing state polling data to forecast outcomes for the 2024 U.S. Presidential Election. Our findings indicate a close race, with Republicans leading in key states such as Michigan, Georgia, Nevada, Wisconsin, and Pennsylvania, while Democrats hold a slight edge in Arizona. The national polling average also leans towards Republican, suggesting a Republican win in the 2024 Election. These insights give us a clearer picture of voter preferences across states and highlight the importance of targeted campaign strategies. 
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false
library(tidyverse)
library(knitr)
library(ggcorrplot)
library(kableExtra)
library(arrow)
library(zoo)
library(brms)
```

# Introduction

The 2024 United States Presidential Election will determine the next president of the United States of America, with the outcome likely to affect both domestic and international policy and economic trends. Former President Donald Trump, the 45th president of the United States, is representing the Republican Party. In contrast, Vice President Kamala Harris is now the Democratic Party's candidate in the 2024 U.S. Presidential Election, following President Joe Biden's decision to withdraw from the race (@BidenQuits). Democracy can be described as liberal and left-leaning, with the emphasis on economy intervention with implementation of policies such as minimum wage and progressive tax rates. Members of the Republican party tend to follow the free economy, and can be described as right-leaning (@RepDem). 

The outcome of the 2024 Presidential Election will determine whether the Republican or Democratic Party will lead the United States for the next four years. Given the United States' significant global influence, accurately predicting the results of this election carries substantial implications for shaping policy direction, ensuring economic stability, and influencing international relations. Reliable predictions enable parties to refine their campaigns and mobilize voters, influencing turnout and perceptions of competitiveness. Additionally, these predictions provide stakeholders with valuable insights that help adjust strategies and facilitate discussions on pressing societal issues. Ultimately, effective election forecasting is essential for understanding governance and its impact on society.

This paper addresses a gap in election forecasting by using recent polling data from key swing states to provide a prediction of the 2024 election outcome. We aim to determine which candidate—Kamala Harris or Donald Trump—is more likely to win this election. Our response variable is in turn the probability of one candidate winning the election based on our chosen Emerson poll data. When one candidate’s support hovers just below 50%, it becomes challenging to predict their election as the 47th President of the United States, especially considering the potential influence of non-participating voters. To increase the accuracy of our predictions, we will develop two models: one estimating the probability of Harris, representing the Democratic Party, winning the election, and the other estimating the probability of Trump, representing the Republican Party, winning. By comparing these predictions, we aim to arrive at a clearer conclusion about who is more likely to be elected as the next President of the United States.

*Results paragraph:* Summarize the key findings of the model, highlighting its predictive accuracy and implications.

The remainder of this paper is structured as follows: @sec-data details the data and measurement process; @sec-results covers model development and results; @sec-discussion discusses implications and future steps.

# Data {#sec-data} 
## Overview 
We sourced the "Presidential General Election Polls" dataset from FiveThirtyEight [@FiveThirtyEight2024] and performed an in-depth analysis using the statistical programming language R [@citeR].

```{r}
#| echo: false
#| warning: false
#| message: false

set.seed(754)
poll_data <- read_parquet(here::here(
  "data/02-analysis_data/summarized_state_poll_data.parquet"))
time_data <- read_parquet(here::here(
  "data/02-analysis_data/timeline_data.parquet"))

poll_data <- poll_data %>%
  mutate(across(12:ncol(.), ~ round(as.numeric(.), 1)))

time_data <- time_data %>%
  mutate(across(5:ncol(.), ~ round(as.numeric(.), 1)))

```

Our primary objective was to clean, organize, and analyze U.S. presidential election polling data to provide insights into voter preferences by state. This involved selecting data from reputable pollsters, organizing it by state, and addressing any missing or incomplete entries. Additional datasets were merged where necessary, and after thoroughly addressing missing values, we finalized a polished dataset ready for analysis. Below is a table summarizing the polling data by state, showcasing voter preferences by party and demographic breakdowns. The table highlights key trends and differences across states in terms of party lean and demographic distribution. @fig-predictors-pct-summary-1 and @fig-predictors-pct-summary-2 provides a snapshot of these findings.

```{r}
#| label: fig-predictors-pct-summary
#| tbl-cap: "Latest Poll Points by Party"
#| echo: false
#| warning: false
#| message: false

# Specify the predictor columns
predictor_columns <- c(
  "What is the highest level of education you have attained? College graduate",
  "What is the highest level of education you have attained? High school or less",
  "Can you please tell me your gender? Female",
  "Can you please tell me your gender? Male",
  "For statistical purposes only, can you please tell me your ethnicity? White or Caucasian",
  "For statistical purposes only, can you please tell me your ethnicity? Hispanic or Latino of any race",
  "Who did you vote for in the 2020 election? Donald Trump",
  "Who did you vote for in the 2020 election? Joe Biden",
  "Although you are undecided, which candidate do you lean toward? Donald Trump",
  "Although you are undecided, which candidate do you lean toward? Kamala Harris"
)


# Filter poll_data to include only the specified states
poll_summary <- poll_data %>%
  filter(state %in% c("Michigan", "Georgia", "Nevada", "North Carolina", 
                      "New Hampshire", "Wisconsin", "Pennsylvania", "Arizona")) %>%
  group_by(state) %>%   
  summarise(
    dem_total_pct = sum(democrat_pct, na.rm = TRUE),
    rep_total_pct = sum(republican_pct, na.rm = TRUE),
    highly_educated_pct = mean(`What is the highest level of education you have attained? College graduate`, na.rm = TRUE),
    lower_educated_pct = mean(`What is the highest level of education you have attained? High school or less`, na.rm = TRUE),
    female_pct = mean(`Can you please tell me your gender? Female`, na.rm = TRUE),
    male_pct = mean(`Can you please tell me your gender? Male`, na.rm = TRUE),
    non_binary_other_pct = mean(`Can you please tell me your gender? Nonbinary or other`, na.rm = TRUE),
    caucasian_pct = mean(`For statistical purposes only, can you please tell me your ethnicity? White or Caucasian`, na.rm = TRUE),
    minority_pct = 100 - caucasian_pct,
    past_vote_biden = mean(`Who did you vote for in the 2020 election? Joe Biden`, na.rm = TRUE),
    past_vote_trump = mean(`Who did you vote for in the 2020 election? Donald Trump`, na.rm = TRUE)
  )

# Rename columns for clarity
colnames(poll_summary) <- c("State", "Democrat Pct", "Republican Pct", 
                            "High Educated", "Low Educated", "Female", 
                            "Male", "Nonbinary", "Caucasian", 
                            "Minority Ethnicity", "Voted Biden 2020", "Voted Trump 2020")

# Create summary tables
poll_summary_party <- poll_summary %>%
  select(State, `Democrat Pct`, `Republican Pct`, `Voted Biden 2020`, `Voted Trump 2020`)

poll_summary_demographics <- poll_summary %>%
  select(State, `High Educated`, `Low Educated`, `Female`, 
         `Male`, `Nonbinary`, `Caucasian`, `Minority Ethnicity`)

# Display table for party percentages
kable(poll_summary_party) %>%
  kable_styling(font_size = 10, position = "center", full_width = FALSE)

# Display table for demographic variables
kable(poll_summary_demographics) %>%
  kable_styling(font_size = 6, position = "center", full_width = FALSE)

```

## Measurement  
We chose Emerson as our primary pollster, and the reasoning for this is detailed in @sec-appenA. Emerson's polls offered crucial information, such as polling dates, party affiliations, sample sizes, and the percentage of support for each political party.

Our analysis centered on voter preferences by party rather than individual candidates. This approach was more relevant for identifying overall trends and helped us forecast which states might swing in future elections, especially swing states. We will discuss this focus further in our results section, @sec-results.

The Emerson dataset also included valuable demographic data, voting history, and approval ratings. To ensure a consistent analysis, we concentrated on questions that were uniformly asked across all states. This approach allowed us to aggregate and analyze data at the state level without being limited by state-specific polling variations.

## Outcome Variables  
Our initial analysis of the dataset revealed important trends in party preferences across states. In @fig-party-results, we show which states have the strongest leanings toward the Democratic or Republican parties. This visualization is crucial for identifying key swing states, which lie near the center of the graph and show nearly equal support for both parties. These states are especially important for predicting the 2024 election outcome. 

From this analysis, we identified eight critical swing states: Georgia, Michigan, National, Nevada, New Hampshire, North Carolina, Pennsylvania, and Wisconsin. These states will be central to our election prediction. Although Minnesota emerged as a potential swing state, we excluded it due to the wide range of polling data, as explained in @tbl-final-summary. Additionally, we will consider the national average in our overall prediction.
  
```{r}
#| label: fig-party-results
#| fig-cap: Example Predictor Variable Visualization
#| echo: false
#| warning: false
#| message: false

poll_summary <- poll_data %>%
  group_by(state) %>%   
  summarise(
    dem_total_pct = sum(democrat_pct, na.rm = TRUE),
    rep_total_pct = sum(republican_pct, na.rm = TRUE)
  ) %>%
   mutate(party_diff = dem_total_pct - rep_total_pct)

# Create the vertical bar graph
ggplot(poll_summary, aes(x = party_diff, y = reorder(state, party_diff))) +
  geom_col(aes(fill = party_diff > 0), show.legend = FALSE) +  
  scale_fill_manual(values = c("red", "blue")) +  
  labs(x = "Party Lean (Democrat vs. Republican)", y = "State",
       title = "Party Leaning by State (Democrat vs. Republican)") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 6))  

```
  
```{r}
#| label: tbl-final-summary
#| echo: false
#| warning: false
#| message: false
# Filter time_data for 'DEM' in the 'party' column
dem_data <- time_data %>%
  filter(party == "DEM")

# Calculate 95% confidence interval for each unique state in 'DEM' data
dem_ci_summary <- dem_data %>%
  group_by(state) %>%
  summarise(
    mean_pct = mean(pct, na.rm = TRUE),
    sd_pct = sd(pct, na.rm = TRUE),
    n = sum(!is.na(pct)),
    lower_95 = ifelse(n >= 2, mean_pct - qt(0.975, df = n - 1) * (sd_pct / sqrt(n)), NA),
    upper_95 = ifelse(n >= 2, mean_pct + qt(0.975, df = n - 1) * (sd_pct / sqrt(n)), NA)
  ) %>%
  # Filter out intervals where the bounds go below 40 or above 60, and remove rows where mean_pct exceeds 50
  filter(!(lower_95 < 35 | upper_95 > 65) & mean_pct <= 100)

# Filter time_data for 'REP' in the 'party' column
rep_data <- time_data %>%
  filter(party == "REP")

# Calculate 95% confidence interval for each unique state in 'REP' data
rep_ci_summary <- rep_data %>%
  group_by(state) %>%
  summarise(
    mean_pct = mean(pct, na.rm = TRUE),
    sd_pct = sd(pct, na.rm = TRUE),
    n = sum(!is.na(pct)),
    lower_95 = ifelse(n >= 2, mean_pct - qt(0.975, df = n - 1) * (sd_pct / sqrt(n)), NA),
    upper_95 = ifelse(n >= 2, mean_pct + qt(0.975, df = n - 1) * (sd_pct / sqrt(n)), NA)
  ) %>%
  # Filter out intervals where the bounds go below 40 or above 60, and remove rows where mean_pct exceeds 50
  filter(!(lower_95 < 35 | upper_95 > 65) & mean_pct <= 50)

# Find the intersection of states in both summaries
common_states <- intersect(dem_ci_summary$state, rep_ci_summary$state)

# Filter both summaries to only include the common states
final_dem_ci_summary <- dem_ci_summary %>%
  filter(state %in% common_states)

final_rep_ci_summary <- rep_ci_summary %>%
  filter(state %in% common_states)

# Create the final summary table and round values to 1 decimal point
final_summary_table <- data.frame(
  State = common_states,
  DEM_Mean = round(final_dem_ci_summary$mean_pct, 1),
  DEM_Lower = round(final_dem_ci_summary$lower_95, 1),
  DEM_Upper = round(final_dem_ci_summary$upper_95, 1),
  REP_Mean = round(final_rep_ci_summary$mean_pct, 1),
  REP_Lower = round(final_rep_ci_summary$lower_95, 1),
  REP_Upper = round(final_rep_ci_summary$upper_95, 1)
)

# Print the final summary table using kable
library(knitr)
kable(
  final_summary_table,
  caption = "Final Summary Table of 95% Confidence Intervals for Common States",
  col.names = c("State", "DEM Mean (%)", "DEM Lower 95%", "DEM Upper 95%", "REP Mean (%)", "REP Lower 95%", "REP Upper 95%"),
  format = "markdown"
)


```
  
```{r}
#| label: fig-party-extremes
#| fig-cap: Demographic Differences Between California and South Dakota
#| echo: false
#| warning: false
#| message: false

# Prepare the poll_summary data frame
poll_summary <- poll_data %>%
  mutate(party_diff = democrat_pct - republican_pct) %>%
  select(-c(2, 3, 4, 6, 7, 8, 9, 11)) %>%  # Remove specific columns by index
  select(-contains('Mode')) %>%             # Remove columns containing 'Mode' in their names
  select(-contains('registration')) %>%
  select(-democrat_pct, -republican_pct)    # Exclude 'democrat_pct' and 'republican_pct'

# Function to compute mean differences for all numeric variables
compute_mean_differences <- function(data, blue_state, red_state) {
  numeric_vars <- data %>%
    select(-state, -party_diff) %>%
    select(where(is.numeric)) %>%
    names()
  
  blue_means <- data %>%
    filter(state == blue_state) %>%
    summarise(across(all_of(numeric_vars), mean, na.rm = TRUE))
  
  red_means <- data %>%
    filter(state == red_state) %>%
    summarise(across(all_of(numeric_vars), mean, na.rm = TRUE))
  
  diff_df <- tibble(
    Variable = numeric_vars,
    Blue_Mean = as.numeric(blue_means[1, ]),
    Red_Mean = as.numeric(red_means[1, ]),
    Abs_Difference = abs(Blue_Mean - Red_Mean)
  ) %>%
  filter(!is.na(Blue_Mean) & !is.na(Red_Mean))
  
  diff_df
}

# Function to prepare data for plotting
prepare_plot_data <- function(diff_df, top_n = 6) {
  top_diff_vars <- diff_df %>%
    arrange(desc(Abs_Difference)) %>%
    slice(1:top_n)
  
  top_diff_vars %>%
    pivot_longer(
      cols = c("Blue_Mean", "Red_Mean"), 
      names_to = "Group", 
      values_to = "Mean"
    ) %>%
    mutate(Group = recode(Group, "Blue_Mean" = "California", "Red_Mean" = "South Dakota"))
}

# Function to create the comparison plot
create_comparison_plot <- function(plot_data) {
  ggplot(plot_data, aes(
    x = reorder(Variable, -Mean), 
    y = Mean, 
    fill = Group, 
    label = round(Mean, 1)
  )) +
    geom_col(position = position_dodge(width = 0.9)) +
    geom_text(
      position = position_dodge(width = 0.9), 
      vjust = -0.3, 
      size = 3
    ) +
    # Update the colors and labels for the groups
    scale_fill_manual(values = c("California" = "blue", "South Dakota" = "red")) +
    labs(
      title = "Demographic Differences Between California and South Dakota",
      x = "Demographic Variable",
      y = "Mean Percentage",
      fill = "State"
    ) +
    scale_y_continuous(limits = c(0, 100)) +
    theme_minimal() +
    theme(
      axis.text.x = element_text(angle = 45, hjust = 1, size = 4)
    )
}

# Main analysis function
analyze_state_differences <- function(data, blue_state, red_state, top_n_vars = 5) {
  diff_df <- compute_mean_differences(data, blue_state, red_state)
  
  plot_data <- prepare_plot_data(diff_df, top_n = top_n_vars)
  
  plot <- create_comparison_plot(plot_data)
  
  list(
    plot = plot,
    top_variables = diff_df %>% arrange(desc(Abs_Difference)) %>% slice(1:top_n_vars)
  )
}

# Ensure 'state' column exists in poll_summary
if (!"state" %in% colnames(poll_summary)) {
  stop("The 'state' column does not exist in poll_summary.")
}

# Run the analysis for California and South Dakota
analysis_results <- analyze_state_differences(poll_summary, blue_state = "California", red_state = "South Dakota", top_n_vars = 6)

# Display the plot
analysis_results$plot
```
Beyond identifying swing states, it's also important to understand the differences between the strongest Democratic ("blue") and Republican ("red") states. The bar graph in @fig-party-extremes highlights these differences. It focuses on key factors that create the biggest contrasts between Democratic-leaning and Republican-leaning states, helping to show how these factors differ between the most extreme red and blue states. 

To start, the graph features two bars, one for Democratic points and one for Republican points, reflecting the responses to questions asked by Emerson Pollster about voting intentions. These responses closely align with the percentages shown for each state, giving us a clear picture of voter preferences.

The @fig-party-extremes visualization gives us valuable insight into how people’s poll responses may influence their political leanings. 

Through these visualizations, we not only identify which states are most likely to swing in future elections but also better understand the public opinions driving these partisan divides.

## Predictor Variables  

We then take a closer look at the demographic and social factors that shape voter preferences. The predictors we analyze include education levels, gender, and past voting behavior. These variables are important because they significantly impact political leanings and can influence how a state is likely to vote.

```{r}
#| label: updating-predictors
#| echo: false
#| warning: false
#| message: false

column_refs <- list(
  democrat = "democrat_pct",
  republican = "republican_pct",
  highly_educated = "What is the highest level of education you have attained? College graduate",
  lower_educated = "What is the highest level of education you have attained? High school or less",
  female = "Can you please tell me your gender? Female",
  male = "Can you please tell me your gender? Male",
  caucasian = "For statistical purposes only, can you please tell me your ethnicity? White or Caucasian",
  hispanic_latino = "For statistical purposes only, can you please tell me your ethnicity? Hispanic or Latino of any race",
  vote_trump = "Who did you vote for in the 2020 election? Donald Trump",
  vote_biden = "Who did you vote for in the 2020 election? Joe Biden",
  lean_trump ="Although you are undecided, which candidate do you lean toward? Donald Trump",
  lean_Kamala ="Although you are undecided, which candidate do you lean toward? Kamala Harris"

)
```

In @fig-predictors-party-pct, we examine how these factors correlate with party lean across U.S. states. This analysis helps identify which factors have the greatest influence in each state, providing a clearer understanding of what drives voter behavior.

```{r}
#| label: fig-predictors-party-pct
#| fig-cap: Example Predictor Variable Visualization
#| echo: false
#| warning: false
#| message: false

# Calculate poll_summary with rounding to the nearest tenth
poll_summary <- poll_data %>%
  group_by(state) %>%
  summarise(
    dem_total_pct = round(sum(.data[[column_refs$democrat]], na.rm = TRUE), 1),
    rep_total_pct = round(sum(.data[[column_refs$republican]], na.rm = TRUE), 1),
    highly_educated_pct = round(mean(.data[[column_refs$highly_educated]], na.rm = TRUE), 1),
    lower_educated_pct = round(mean(.data[[column_refs$lower_educated]], na.rm = TRUE), 1),
    female_pct = round(mean(.data[[column_refs$female]], na.rm = TRUE), 1),
    male_pct = round(mean(.data[[column_refs$male]], na.rm = TRUE), 1),
    caucasian_pct = round(mean(.data[[column_refs$caucasian]], na.rm = TRUE), 1),
    minority_pct = round(100 - caucasian_pct, 1)
  ) %>%
  mutate(party_diff = round(dem_total_pct - rep_total_pct, 1)) %>%
  drop_na()

# Select relevant numeric columns for correlation matrix, excluding lean_trump and lean_kamala
corr_data <- poll_summary %>%
  select(
    Democrat = dem_total_pct,
    Republican = rep_total_pct,
    HighlyEducated = highly_educated_pct,
    LowerEducated = lower_educated_pct,
    Female = female_pct,
    Male = male_pct,
    Caucasian = caucasian_pct,
    Minority = minority_pct
  )

# Calculate the correlation matrix
cor_matrix <- cor(corr_data, use = "complete.obs")

# Set correlations less than -0.9 to NA
cor_matrix[cor_matrix < -0.9] <- NA

# Visualize the correlation matrix without hierarchical clustering
ggcorrplot(cor_matrix, 
           hc.order = FALSE,  
           type = "lower", 
           lab = TRUE, 
           lab_size = 2,  # Size for correlation labels
           title = "Correlation Matrix of Predictors and Party Lean",
           colors = c("blue", "white", "red"),  
           legend.title = "Correlation") +
  theme(
    plot.title = element_text(size = 12, hjust = 0.5),  # Title size and centered
    axis.text = element_text(size = 1),  # Axis text size
    legend.text = element_text(size = 10),  # Legend text size
    legend.title = element_text(size = 10),  # Legend title size
    axis.title = element_text(size = 1)  # Axis labels size
  )


```
  
```{r}
#| label: fig-predictors-party-pct-2
#| fig-cap: Example Voting and Leaning Predictor Variable Visualization
#| echo: false
#| warning: false
#| message: false

# Calculate poll_summary_2 with rounding to the nearest tenth
poll_summary_2 <- poll_data %>%
  group_by(state) %>%
  summarise(
    dem_total_pct = round(sum(.data[[column_refs$democrat]], na.rm = TRUE), 1),
    rep_total_pct = round(sum(.data[[column_refs$republican]], na.rm = TRUE), 1),
    vote_trump_pct = round(mean(.data[[column_refs$vote_trump]], na.rm = TRUE), 1),
    vote_biden_pct = round(mean(.data[[column_refs$vote_biden]], na.rm = TRUE), 1),
    lean_trump_pct = round(mean(.data[[column_refs$lean_trump]], na.rm = TRUE), 1),
    lean_kamala_pct = round(mean(.data[[column_refs$lean_Kamala]], na.rm = TRUE), 1)
  ) %>%
  mutate(party_diff = round(dem_total_pct - rep_total_pct, 1)) %>%
  drop_na()

# Select relevant numeric columns for correlation matrix, excluding PartyDifference
corr_data_2 <- poll_summary_2 %>%
  select(
    Democrat = dem_total_pct,
    Republican = rep_total_pct,
    VotedTrump2020 = vote_trump_pct,
    VotedBiden2020 = vote_biden_pct,
    LeanTrump = lean_trump_pct,
    LeanKamala = lean_kamala_pct
  )

# Calculate the correlation matrix
cor_matrix_2 <- cor(corr_data_2, use = "complete.obs")

# Set correlations less than -0.9 to NA
cor_matrix_2[cor_matrix_2 < -0.9] <- NA

# Visualize the correlation matrix without hierarchical clustering
ggcorrplot(cor_matrix_2, 
           hc.order = FALSE,  
           type = "lower", 
           lab = TRUE, 
           lab_size = 2,  # Size for correlation labels
           title = "Correlation Matrix of Voting Preferences and State Lean",
           colors = c("blue", "white", "red"),  
           legend.title = "Correlation") +
  theme(
    plot.title = element_text(size = 10, hjust = 0.5),  # Title size and centered
    axis.text = element_text(size = 1),  # Axis text size
    legend.text = element_text(size = 10),  # Legend text size
    legend.title = element_text(size = 10),  # Legend title size
    axis.title = element_text(size = 1)  # Axis labels size
  )

```   

The correlation matrix in @fig-predictors-party-pct shows how different predictors relate to party preferences. We can see which factors, like education or gender, are more strongly tied to Democratic or Republican leanings. Blue shading indicates stronger Democratic support, while red shows stronger Republican support. Key observations include higher education being linked to Democratic support and lower education favoring Trump in 2020. Minority groups generally lean Democratic, while Caucasian/White voters tend to support Trump. Past voter behavior shows Biden supporters remain Democratic, and Trump supporters disapprove of Biden. Additionally, women lean slightly more Democratic compared to men, who often lean Republican.

```{r}
#| label: fig-points-over-time
#| tbl-cap: "Parties Approval and Leaning Preferences"
#| echo: false
#| warning: false
#| message: false

# Convert `end_date` to Date format, ensure numeric columns, and limit to 2024 and onward
time_data_graph <- time_data %>%
  mutate(
    end_date = as.Date(end_date, format = "%Y-%m-%d"),  # Format matches YYYY-MM-DD
    pct = as.numeric(pct),
    lean_trump = as.numeric(`Although you are undecided, which candidate do you lean toward? Donald Trump`),
    lean_kamala = as.numeric(`Although you are undecided, which candidate do you lean toward? Kamala Harris`)
  ) %>%
  filter(end_date >= as.Date("2024-01-01")) %>%  # Limit data to 2024 and onward
  arrange(end_date)  # Ensure data is sorted by end_date

# Separate data for Democrats and Republicans
democrat_data <- time_data_graph %>%
  filter(party == "DEM", !is.na(pct)) %>%
  filter(state == "National") %>%
  arrange(end_date)

republican_data <- time_data_graph %>%
  filter(party == "REP", !is.na(pct)) %>%
  filter(state == "National") %>%
  arrange(end_date)

# Average `lean_trump` values for the same date, keep one entry, and limit to 4 entries per month
lean_trump_data <- time_data_graph %>%
  select(end_date, lean_trump) %>%
  filter(!is.na(lean_trump)) %>%
  group_by(month = floor_date(end_date, "month")) %>%
  arrange(end_date) %>%
  slice_head(n = 4) %>%  # Limit to 4 entries per month
  ungroup() %>%
  select(-month) %>%
  group_by(end_date) %>%
  summarise(lean_trump = mean(lean_trump, na.rm = TRUE)) %>%  # Average values
  arrange(end_date)

# Average `lean_kamala` values for the same date, keep one entry, and limit to 4 entries per month
lean_kamala_data <- time_data_graph %>%
  select(end_date, lean_kamala) %>%
  filter(!is.na(lean_kamala)) %>%
  group_by(month = floor_date(end_date, "month")) %>%
  arrange(end_date) %>%
  slice_head(n = 4) %>%  # Limit to 4 entries per month
  ungroup() %>%
  select(-month) %>%
  group_by(end_date) %>%
  summarise(lean_kamala = mean(lean_kamala, na.rm = TRUE)) %>%  # Average values
  arrange(end_date)

# Create the time plot with ggplot2
ggplot() +
  # Plot Democrats' pct over time (blue)
  geom_line(data = democrat_data, aes(x = end_date, y = pct, color = "Democrats"), size = 1) +
  
  # Plot Republicans' pct over time (red)
  geom_line(data = republican_data, aes(x = end_date, y = pct, color = "Republicans"), size = 1) +
  
  # Plot Leaning Toward Trump over time (dark orange)
  geom_line(data = lean_trump_data, aes(x = end_date, y = lean_trump, color = "Lean Trump"), size = 0.6) +
  
  # Plot Leaning Toward Kamala over time (purple)
  geom_line(data = lean_kamala_data, aes(x = end_date, y = lean_kamala, color = "Lean Kamala"), size = 0.6) +
  
  # Customize labels, theme, colors, and y-axis limits
  labs(
    title = "Democrat vs. Republican and Leaning Preferences Over Time",
    x = "Date",
    y = "Percentage (%)",
    color = "Legend"
  ) +
  scale_color_manual(values = c("Democrats" = "blue", "Republicans" = "red", "Lean Trump" = "darkorange", "Lean Kamala" = "purple")) +
  ylim(25, 55) +  # Set y-axis range from 25 to 55, adjust if needed
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

Lastly, we examine Democratic and Republican support alongside Biden's approval over time, marking July 21st when Joe Biden concluded his campaign, as reported by @globalnews2024. During this period, Democratic support was initially low but increased following this change. By analyzing specific demographic factors and previous voting behavior, we aim to predict the 2024 election outcome.

Key predictor variables:

- **Education**: This measures education levels, with higher education often correlating with more Democratic support.
- **Race/Ethnicity**: This examines how different racial and ethnic groups tend to align politically, with minority groups often leaning Democratic and White/Caucasian voters leaning Republican.
- **Gender**: This captures how gender influences party preference, with women generally leaning more Democratic and men more Republican.
- **Priors (Past Voting Behavior)**: This looks at who people voted for in the past, helping us understand ongoing political support or disapproval.
- **Biden's Approval Rating**: This assesses how approval or disapproval of Joe Biden impacts Democratic support, providing insight into shifting voter sentiments.

# Model {#sec-model}

## Forecasting Vote Outcomes in Key Swing States

Our model aims to forecast the voting outcome of the 2024 U.S. presidential election, focusing specifically on eight pivotal swing states. We carefully selected predictor variables based on a correlation matrix we generated previously (see Figure @fig-predictors-party-pct).

## Model Design and Approach

We constructed two separate Bayesian generalized linear models to estimate the percentage likelihood of Trump and Harris winning in each swing state. Our models look at demographic and historical data that let us to generate probabilistic predictions for both candidates. These models provide insights into which candidate is more likely to secure a win, even in closely contested states.

## Key Components of Our Models

- **Outcome Variables**: The percentage of the popular vote each candidate is expected to receive.
- **Predictor Variables**: We include factors such as education level (e.g., college graduate vs. high school or less), gender distribution (male vs. female), and ethnic demographics (White or Caucasian vs. Hispanic or Latino). Additionally, historical voting patterns (e.g., 2020 voting preferences) and current leanings toward Trump or Harris are crucial predictors.
- **Model Structure**: Each model incorporates an intercept to represent baseline support and predictor coefficients to quantify the effect of each variable on the vote share. We use a Beta distribution to account for the bounded nature of percentage outcomes, ensuring our predictions remain between 0 and 100%.

## Assumptions Underlying Our Models

1. **Linearity**: The relationship between each predictor and vote share is assumed to be approximately linear.
2. **Independence**: We assume that vote share predictions for each state are independent, conditional on the included predictors.
3. **Non-Normality**: Given the non-normal distribution of our response variables, using a generalized linear model is more appropriate. Our analysis revealed that the distribution of Democratic support resembles a Poisson-like distribution, while Republican support shows multimodal characteristics.
4. **Priors**: We applied weakly informative priors to regularize our predictions, with specific priors for those who voted for Trump and Biden in 2020, aligning with historical voting trends.

## Bayesian Modeling Implementation

We implemented our models using the `brms` package in R, which allows for flexible Bayesian regression modeling. The models were fit with four chains, running 6,000 iterations each, to ensure convergence and reliable posterior estimates. Sensible default priors were adjusted to reflect our prior knowledge about voting behavior, and we conducted posterior predictive checks to assess the models' performance.

## Results and Interpretation

The results, summarized in Table @tbl-modelresults, highlight the predicted vote shares for each candidate in the swing states. For each state, we report the posterior mean, as well as 95% credible intervals, to capture the range of plausible outcomes. Our findings underscore the impact of demographic and historical factors on voting behavior, providing a nuanced understanding of which states are likely to be battlegrounds in the upcoming election.

By using a Bayesian approach, we not only make point estimates but also quantify the uncertainty surrounding these predictions. This is crucial for election forecasting, where even small shifts in voter behavior can have significant implications. Our analysis will inform campaign strategies and identify states where mobilizing specific demographics could be pivotal.


```{r}
#| label: fig-results-model
#| tbl-cap: "Forecasting model results based on poll data"
#| echo: false
#| warning: false
#| message: false
# Define the swing states of interest
swing_states <- c("Michigan", "Georgia", "Nevada", "North Carolina", "New Hampshire", "Wisconsin", "Pennsylvania", "Arizona", "National")

# Filter data for the specified swing states and remove any missing data
swing_data <- time_data %>%
  filter(state %in% swing_states, end_date > as.Date("2024-07-21")) %>%
  na.omit()

# Rename columns in swing_data for easier reference
swing_data <- swing_data %>%
  rename(
    `What.is.the.highest.level.of.education.you.have.attained..College.graduate` = "What is the highest level of education you have attained? College graduate",
    `What.is.the.highest.level.of.education.you.have.attained..High.school.or.less` = "What is the highest level of education you have attained? High school or less",
    `Can.you.please.tell.me.your.gender..Female` = "Can you please tell me your gender? Female",
    `Can.you.please.tell.me.your.gender..Male` = "Can you please tell me your gender? Male",
    `For.statistical.purposes.only..can.you.please.tell.me.your.ethnicity..White.or.Caucasian` = "For statistical purposes only, can you please tell me your ethnicity? White or Caucasian",
    `For.statistical.purposes.only..can.you.please.tell.me.your.ethnicity..Hispanic.or.Latino.of.any.race` = "For statistical purposes only, can you please tell me your ethnicity? Hispanic or Latino of any race",
    `Who.did.you.vote.for.in.the.2020.election..Donald.Trump` = "Who did you vote for in the 2020 election? Donald Trump",
    `Who.did.you.vote.for.in.the.2020.election..Joe.Biden` = "Who did you vote for in the 2020 election? Joe Biden",
    `Although.you.are.undecided..which.candidate.do.you.lean.toward..Donald.Trump` = "Although you are undecided, which candidate do you lean toward? Donald Trump",
    `Although.you.are.undecided..which.candidate.do.you.lean.toward..Kamala.Harris` = "Although you are undecided, which candidate do you lean toward? Kamala Harris"
  )

# Calculate how to distribute the states evenly
num_states <- length(swing_states)
rows_per_state <- floor(nrow(swing_data) / num_states)
extra_rows <- nrow(swing_data) %% num_states

# Create a vector of state names to match the total number of rows
state_vector <- rep(swing_states, each = rows_per_state)
if (extra_rows > 0) {
  state_vector <- c(state_vector, swing_states[1:extra_rows])
}

# Check if the length matches, then assign to swing_data
if (length(state_vector) == nrow(swing_data)) {
  swing_data$State <- state_vector
} else {
  stop("Mismatch between the number of rows in swing_data and the length of state_vector")
}

# Load pre-trained models
bayesian_model_dem <- readRDS(here::here("models/bayesian_model_dem.rds"))
bayesian_model_rep <- readRDS(here::here("models/bayesian_model_rep.rds"))

# Generate predictions for Democratic and Republican models
predictions_dem <- posterior_predict(bayesian_model_dem, newdata = swing_data)
predictions_rep <- posterior_predict(bayesian_model_rep, newdata = swing_data)

# Function to summarize predictions by state
aggregate_summary <- function(predictions, state_labels) {
  summary_df <- data.frame(State = character(), mean = numeric(), lower = numeric(), upper = numeric())
  for (state in unique(state_labels)) {
    state_indices <- which(state_labels == state)
    state_predictions <- predictions[, state_indices]
    state_mean <- mean(state_predictions)
    state_lower <- quantile(state_predictions, 0.025)
    state_upper <- quantile(state_predictions, 0.975)
    summary_df <- rbind(summary_df, data.frame(State = state, mean = state_mean, lower = state_lower, upper = state_upper))
  }
  return(summary_df)
}

# Summarize predictions for both Democrat and Republican models
dem_summary <- aggregate_summary(predictions_dem, swing_data$State)
rep_summary <- aggregate_summary(predictions_rep, swing_data$State)

# Combine summaries into the final prediction summary
prediction_summary <- data.frame(
  State = dem_summary$State,
  DEM_Mean = dem_summary$mean,
  DEM_Lower = dem_summary$lower,
  DEM_Upper = dem_summary$upper,
  REP_Mean = rep_summary$mean,
  REP_Lower = rep_summary$lower,
  REP_Upper = rep_summary$upper
)
```

# Results {#sec-results}

Our results are summarized in @tbl-modelresults.

```{r}
#| label: tbl-modelresults
#| tbl-cap: "Prediction Summary for Swing States with Declared Winner"
#| echo: false
#| warning: false
#| message: false

# Modify the prediction summary
prediction_summary <- prediction_summary %>%
  select(State, DEM_Mean, REP_Mean) %>%  # Keep only the mean columns
  mutate(Winner = ifelse(DEM_Mean > REP_Mean, "Democrat", "Republican"))

# Create a formatted table
kable(
  prediction_summary,
  col.names = c("State", "Democrat Points", "Republican Points", "Winner"),
  format = "latex", 
  digits = 2,
  escape = FALSE
) %>%
  kable_styling(
    latex_options = c("striped", "hold_position", "condensed"), 
    full_width = FALSE, 
    font_size = 10
  )


```

# Discussion {#sec-discussion}

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

Please don't use these as sub-heading labels - change them to be what your point actually is.

## Third discussion point

Discuss what the model reveals about the election forecast and its potential impact on understanding voting behavior.

*Person C*: Discuss limitations of the model and areas for further improvement.

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}

## Appendix A: Pollster Methodology Overview {-}
Emerson College Polling was initially a college polling exercise and is now an "innovative, nationally-ranked" non-partisan polling center (@AboutUs). For the 2024 USA Presidential Election pollster, the Emerson College Polling defined the population to be "likely voters" of 2024 United States Presidential Election. Emerson College Polling does indicate that the targeted population of "likely voters" is based on "2024 Likely Voter Modeling." However, the methodology for this modelling and the specific model is not indicated, so the specific validity of the targeted population cannot be determine (@Polling).

Emerson College Polling recruits people completing this survey for this national pollster by contacting mobile phones using "MMS-to-Online", "Online Opt-in Panel", and "IVR(Interactive Voice Response)" (@Polling). In the MMS-to-Online approach, the target population were sent text messages with graphics that invite them to take a "screening questionnaire", and those who pass the questionnaire can move on to take the survey. The selected respondents were based on state voter files "provided by Aristotle." The Online Opt-in Panel approach involves respondents from the targeted population being invited to finish the survey by means of an online opt-in panel "provided by CINT" (@AboutUs). Specifically, in the Online Panel approach, selected voters were pre-matched to "L2 voter file data provided by Rep Data" (@Polling). Finally, the IVR approach involves making automatic telephone calls to selected "likely voters." Participants then answer the survey using their "touch-tone telephone". The email approach indicated in Emerson College Polling's official methodology (@AboutUs) is not mentioned in the National Polling, so it can be assumed that this approach is not used in our chosen pollster data.

From the methodology of recruiting people indicated in the previous paragraph, we can see that while the targeted population of the national poll are likely voters, the sampling frame are likely voters that use phones, either mobile or landline. Emerson College Polling chooses 1000 samples from their targeted population, in this case is all likely voters of the 2024 United States Presidential Election, and it is then "weighted by gender, education, race, age, party affiliation, and region based on 2024 likely voter modeling" (@Polling) for each national poll. As most people in the United States use phones by some means, the target population and sampling frame are highly similar, increasing the overall validity of the survey. 

In the "MMS-to-Online" and "IVR(Interactive Voice Response)" approaches, random sampling is used, and in the "Online Opt-in Panel" approach, there is no indication of a specific sampling approach (@AboutUs). We can conclude that the general approach used in this specific pollster is random sampling. Random sampling tends to reduce bias, simplify analysis, and is also easy to implement, but at the same time also requires much time and money. In consideration with the sample size of 1000 people compared to the targeted population of likely voters, which contains most of the population of the United States of America, there is a high possibility of existing selection bias, occurring when the participants are not representative of the population.

There is also no specific indication of how non-response is treated, but the results section of national polls, such as the one from September 29 to October 1, 2024, implicates that non-response are eliminated from final recorded results of the survey. Therefore, we cannot ignore the possibility of non-response bias, occurring when non-respondents differ significantly from respondents. For example, such non-response bias occurs when non-respondents are from California, while respondents are from other states except California.

The questionnaire set by Emerson College Polling for this survey, based on the national polls set from September 29 to October 1, 2024, compose mostly of questions with most common choices listed as choices, and also allowing participants to type in their own answer if it is not included in the list of most common choices. The questionnaire is generally written in an objective voice, and all questions only allow participants to make only one choice. All questions in the questionnaire are relatively-common, including ones about ethnicity, age range, region, and education which collects demographical data, and ones that are related to actual presidential-election predictions, including opinions about Joe Biden's performance, the two major parties (Democratic and Republican), whether s/he would vote, and voting inclinations. The only issue observed in the questionnaire is that it is too lengthy, containing more than 20 questions, which may decrease participants' motivations to complete the survey, even after starting it (@Polling).

Therefore, after analyzing the advantages and disadvantages of this pollster about the 2024 United States Presidential Elections by Emerson College Polling, we can conclude that Emerson College Polling can improve their pollster by implementing the following approaches. Emerson can consider increasing the sample size to make their survey more representative of the targeted population, explicitly describing their definition of the targeted population "likely voters" and the model used to determine characteristics of the targeted population. Emerson can also consider changing from simple random to stratified sampling, based on different states or other demographic features based on their targeted population model, making their sample more representative of the population, decrease the length of the questionnaire, and also explicitly explain their treatment of non-response, which will increase the validity of the study. Overall, this pollster is still highly valid, and generally reliable for predicting the 2024 United States Presidential Election.

## Appendix B: Idealized Survey Design for $100K Budget {-}

## Introduction {-}

This appendix introduces an idealized methodology and survey to forecast the US presidential election with a budget of $100k. The goal is to use a sample survey that effectively captures public opinion and demographic characteristics.


## Sampling Approach {-}

In order to most accurately represent the sample population of US voters, we will be using a stratified random sampling approach. Stratified random sampling efficiently and fairly samples data from strata that are representative of a population compared to simple random sampling since it also reflects the population of interest’s underrepresented subgroups, ultimately reducing potential bias. 

The sample population will be taken from 10,000 eligible US voters represented in strata divided into different demographic factors such as age, gender, race, education level, income level, and political affiliation. This sample size can provide a statistically significant confidence interval for the strata.

## Respondent Recruitment {-}

We will be using 70% of our budget for respondent recruitment, and the remaining 30% for implementing the survey and validating results.

A proportion of our budget of $20,000 will be used for advertising on various social media platforms such as Instagram, Facebook, and Twitter to reach around 10,000 respondents. This online advertising is a good way to reach target respondents based on different demographics we are interested in, especially for younger or hard-to-reach populations. 

Since digital ads may result in higher dropout rates and lower response quality, the majority of our budget will be allocated to make up for this limitation. A budget of $40,000 can be used to hire professional survey panels that work with companies that can provide large databases of target respondents that have been pre-screened to match our demographic of interest. 
Lastly, since pre-screened professional survey panels can introduce bias from being frequent survey responders, we will also use incentivized online survey platforms to recruit various participants that fit our demographics of interest. Participants will be offered small monetary incentives with our budget of $10,000, which can greatly increase completion rates and result in better response quality.

## Data Validation {-}

First, we need pre-screening questions to confirm the eligibility of respondents such as eligibility to vote to prevent bots and fake responses. For instance, asking whether they are a US citizen, and then asking if they are eligible to vote in the upcoming US presidential election. If their answers contradict these two questions, we know that their response lacks validity.

Additionally, we have attention checks to identify if respondents are paying attention to and understanding the survey questions. For example, we can ask them if they are paying attention to the question, and if they answer no, we know that they might be rushing or answering the survey carelessly.

Furthermore, we want consistency checks that include similar questions which are paraphrased in different parts of the survey to ensure that respondents are answering consistently.

Lastly, IP address monitoring can be used to prevent duplicate responses from the same person.

## Poll Aggregation {-}

We can collect poll data from various reputable polling sources that have good pollster reliability and are from more recent polls. This way, we can weigh the polls according to their quality. For instance, we would assign higher weights to pollsters that have a high rate of pollster reliability based on past results. We would also give higher weights to more recent polls that better showcase the current opinions of the upcoming US election. Lastly, we would emphasize the weight of larger sample sizes since these provide more accurate representation of the population of interest. We can also incorporate the Bayesian Inference method when updating new polls to adjust prior distributions with new information.

Survey Link: https://forms.gle/vm3gKbsMAZvzakFn8

## Copy of Survey {-}

A copy of the survey and its questions are provided below:

**2024 US Presidential Election Survey**

Thank you for considering participation in the 2024 US Presidential Election Survey. The purpose of this survey is to better understand and forecast election results. This survey gathers anonymous data on voter opinions and demographics for the 2024 US presidential election. You may stop the survey at any time without consequence. All responses will remain anonymous, and results will be reported in aggregate form only. A small monetary incentive will be offered upon completion. 

If you have any questions or concerns about this survey, please reach out to any of the researchers below:

Tina Kim, University of Toronto: tinak.kim@mail.utoronto.ca
David Flores, University of Toronto: davidgadiel.flores@mail.utoronto.ca
Kevin Shao, University of Toronto: kevin.shao@mail.utoronto.ca

By proceeding, you confirm your consent to participate.
  - I consent to participate.
  - I do not consent to participate.
  
1. **Are you a US citizen?**
  - Yes
  - No

2. **Are you eligible to vote in the upcoming US presidential election?**
  - Yes
  - No

3. **What is your age group?**
Under 18
  - 18 - 24
  - 25 - 34
  - 35 - 44
  - 45 - 54
  - 55 - 64
  - 65 or older
  - Prefer not to say

4. **What is your gender?**
  - Male
  - Female
  - Non-binary
  - Prefer not to say

5. **What is your ethnicity? (choose all that apply)**
  - White / Caucasian
  - Black or African American
  - Hispanic or Latino
  - Asian
  - Native American or Alaska Native
  - Native Hawaiian or Other Pacific Islander
  - Middle Eastern or North African
  - Other
  - Prefer not to say

6. **What is the highest level of education you have completed?**
  - Less than high school
  - High school diploma or equivalent (e.g., GED)
  - Some college, no degree
  - Associate’s degree
  - Bachelor’s degree
  - Master’s degree
  - Professional degree (e.g., JD, MD)
  - Doctorate (e.g., PhD, EdD)
  - Prefer not to say

7. **Are you paying attention to this survey?**
  - Yes
  - No

8. **What is your income level?**
  - Less than $20,000
  - $20,000 - $39,999
  - $40,000 - $59,999
  - $60,000 - $79,999
  - $80,000 - $99,999
  - $100,000 - $149,999
  - $150,000 - $199,999
  - $200,000 or more
  - Prefer not to say

9. **What is the highest level of education you have attained?**
  - Less than high school
  - High school diploma or equivalent (e.g., GED)
  - Some college, no degree
  - Associate’s degree
  - Bachelor’s degree
  - Master’s degree
  - Professional degree (e.g., JD, MD)
  - Doctorate (e.g., PhD, EdD)
  - Prefer not to say

10. **What is your political affiliation?**
  - Democrat
  - Republican
  - Independent
  - Other
  - Prefer not to say

11. **If the election were held today, which candidate would you vote for?**
  - Candidate A
  - Candidate B
  - Candidate C
  - Other
  - Undecided
  - Prefer not to say

# Additional data details
Include any technical details on data cleaning, model diagnostics, and posterior checks.
# References


